flowchart TD
    %% SagaOfSacrifice2 Actual System Architecture
    
    subgraph "Client Layer"
        Client[Client Application]
        Game[Game Class]
        SDL[SDL Wrapper Client]
        Renderer[Renderer]
        Input[SDL2Input]
        Audio[SDL2AudioManager]
    end

    subgraph "Game Core"
        Player[Player]
        Enemy[Enemy - Minotaur type]
        Tile[Tile/Platform]
        Entity[Entity Base Class]
        Actor[Actor System]
        Level[Level Manager]
    end

    subgraph "Systems"
        InputSys[Input System]
        CollisionMgr[Collision Manager]
        SpatialGrid[SpatialGrid Optimization]
        AnimationCtrl[Animation Controller]
        AudioMgr[Audio Manager]
    end

    subgraph "Network Layer"
        MultiplayerMgr[MultiplayerManager]
        AsioClient[AsioNetworkClient]
        LocalServerMgr[LocalServerManager]
        NetworkMsg[NetworkMessage Types]
    end

    subgraph "Server Components"
        EmbeddedSrv[EmbeddedServer]
        DedicatedSrv[DedicatedServer]
        GameSrvLogic[GameServer Logic]
        ClientMgr[ClientManager]
    end

    subgraph "Collision System"
        CollisionHandler[CollisionHandler - Visitor Pattern]
        BoxCollider[BoxCollider]
        CollisionInfo[CollisionInfo]
        AABB[AABB Detection]
    end

    subgraph "Data & Assets"
        SpriteData[Sprite Data]
        LevelData[Level Files]
        Config[server.json Configuration]
        Assets[Asset Management]
    end

    subgraph "Hardware Layer (FPGA)"
        DMACtrl[DMA Control]
        BRAM[BRAM Controller]
        HardwareRender[Hardware Rendering]
        AudioHW[Audio Hardware]
    end

    %% Main Flow Connections
    Client --> Game
    Game --> Level
    Game --> MultiplayerMgr
    SDL --> Renderer
    SDL --> Input
    SDL --> Audio
    
    %% Core Game Flow
    Level --> Player
    Level --> Enemy
    Level --> Tile
    Level --> CollisionMgr
    CollisionMgr --> SpatialGrid
    CollisionMgr --> CollisionHandler
    CollisionHandler --> BoxCollider
    BoxCollider --> AABB
    
    %% Network Flow
    MultiplayerMgr --> AsioClient
    AsioClient --> EmbeddedSrv
    EmbeddedSrv --> ClientMgr
    EmbeddedSrv --> GameSrvLogic
    NetworkMsg --> MultiplayerMgr
    
    %% Input Processing
    Input --> InputSys
    InputSys --> Player
    InputSys --> MultiplayerMgr
    
    %% Asset Loading
    Assets --> SpriteData
    Assets --> LevelData
    Config --> EmbeddedSrv
    
    %% Hardware Integration
    Renderer --> DMACtrl
    DMACtrl --> BRAM
    BRAM --> HardwareRender
    Audio --> AudioHW
    
    %% Collision Detection Flow
    Entity --> BoxCollider
    SpatialGrid --> AABB
    AABB --> CollisionInfo
    CollisionInfo --> CollisionHandler
    
    %% Server-Client Communication
    GameSrvLogic --> Level
    ClientMgr --> AsioClient
    
    %% Styling
    classDef client fill:#e3f2fd
    classDef core fill:#f3e5f5
    classDef systems fill:#e8f5e8
    classDef network fill:#fff3e0
    classDef server fill:#fce4ec
    classDef collision fill:#f1f8e9
    classDef data fill:#f8f9fa
    classDef hardware fill:#fffde7
    
    class Client,Game,SDL,Renderer,Input,Audio client
    class Player,Enemy,Tile,Entity,Actor,Level core
    class InputSys,CollisionMgr,SpatialGrid,AnimationCtrl,AudioMgr systems
    class MultiplayerMgr,AsioClient,LocalServerMgr,NetworkMsg network
    class EmbeddedSrv,DedicatedSrv,GameSrvLogic,ClientMgr server
    class CollisionHandler,BoxCollider,CollisionInfo,AABB collision
    class SpriteData,LevelData,Config,Assets data
    class DMACtrl,BRAM,HardwareRender,AudioHW hardware
